{"version":3,"file":"workbox-background-sync.prod.v2.0.3.js","sources":["../../../../lib/log-group.js","../../../../lib/environment.js","../../../../lib/log-helper.js","../../../../lib/deprecate.js","../../../../node_modules/idb/lib/idb.js","../../../../lib/idb-helper.js","../../src/lib/response-manager.js","../../src/lib/constants.js","../../src/lib/queue-utils.js","../../src/lib/request-manager.js","../../../../lib/error-stack-parser-no-op.js","../../../../lib/assert.js","../../src/lib/broadcast-manager.js","../../src/lib/request-queue.js","../../src/lib/background-sync-queue.js","../../src/lib/background-sync-queue-plugin.js"],"sourcesContent":["/* eslint-disable no-console */\n\n/**\n * A simple helper to manage the print of a set of logs\n */\nclass LogGroup {\n  /**\n   * @param {object} input\n   */\n  constructor() {\n    this._logs = [];\n    this._childGroups = [];\n\n    this._isFallbackMode = false;\n    const ffRegex = /Firefox\\/(\\d*)\\.\\d*/.exec(navigator.userAgent);\n    if (ffRegex) {\n      try {\n        const ffVersion = parseInt(ffRegex[1], 10);\n        if (ffVersion < 55) {\n          this._isFallbackMode = true;\n        }\n      } catch (err) {\n        this._isFallbackMode = true;\n      }\n    }\n\n    if (/Edge\\/\\d*\\.\\d*/.exec(navigator.userAgent)) {\n      this._isFallbackMode = true;\n    }\n  }\n\n  /**\n   *@param {object} logDetails\n   */\n  addPrimaryLog(logDetails) {\n    this._primaryLog = logDetails;\n  }\n\n  /**\n   *@param {object} logDetails\n   */\n  addLog(logDetails) {\n    this._logs.push(logDetails);\n  }\n\n  /**\n   * @param {object} group\n   */\n  addChildGroup(group) {\n    if (group._logs.length === 0) {\n      return;\n    }\n\n    this._childGroups.push(group);\n  }\n\n  /**\n   * prints out this log group to the console.\n   */\n  print() {\n    if (this._logs.length === 0 && this._childGroups.length === 0) {\n      this._printLogDetails(this._primaryLog);\n      return;\n    }\n\n    if (this._primaryLog) {\n      if (!this._isFallbackMode) {\n        console.groupCollapsed(...this._getLogContent(this._primaryLog));\n      } else {\n        this._printLogDetails(this._primaryLog);\n      }\n    }\n\n    this._logs.forEach((logDetails) => {\n      this._printLogDetails(logDetails);\n    });\n\n    this._childGroups.forEach((group) => {\n      group.print();\n    });\n\n    if (this._primaryLog && !this._isFallbackMode) {\n      console.groupEnd();\n    }\n  }\n\n  /**\n   * Prints the specific logDetails object.\n   * @param {object} logDetails\n   */\n  _printLogDetails(logDetails) {\n    const logFunc = logDetails.logFunc ? logDetails.logFunc : console.log;\n    logFunc(...this._getLogContent(logDetails));\n  }\n\n  /**\n   * Returns a flattened array of message with colors and args.\n   * @param {object} logDetails\n   * @return {Array} Returns an array of arguments to pass to a console\n   * function.\n   */\n  _getLogContent(logDetails) {\n    let message = logDetails.message;\n    if (this._isFallbackMode && typeof message === 'string') {\n      // Replace the %c value with an empty string.\n      message = message.replace(/%c/g, '');\n    }\n\n    let allArguments = [message];\n\n    if (!this._isFallbackMode && logDetails.colors) {\n      allArguments = allArguments.concat(logDetails.colors);\n    }\n\n    if (logDetails.args) {\n      allArguments = allArguments.concat(logDetails.args);\n    }\n    return allArguments;\n  }\n}\n\nexport default LogGroup;\n","/*\n Copyright 2016 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\n/**\n * @private\n * @return {boolean} True, if we're running in the service worker global scope.\n * False otherwise.\n */\nexport function isServiceWorkerGlobalScope() {\n  return ('ServiceWorkerGlobalScope' in self &&\n          self instanceof ServiceWorkerGlobalScope);\n}\n\n/**\n * @private\n * @return {boolean} True, if we're running a development bundle.\n * False otherwise.\n */\nexport function isDevBuild() {\n  // `BUILD_PROCESS_REPLACE::BUILD_TARGET` is replaced during the build process.\n  return `BUILD_PROCESS_REPLACE::BUILD_TARGET` === `dev`;\n}\n\n/**\n * @private\n * @return {boolean} True, if we're running on localhost or the equivalent IP\n * address. False otherwise.\n */\nexport function isLocalhost() {\n  return Boolean(\n    location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n  );\n}\n","/*\n Copyright 2016 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\n/* eslint-disable no-console */\n\nimport LogGroup from './log-group';\nimport {isDevBuild} from './environment';\n\nself.workbox = self.workbox || {};\nself.workbox.LOG_LEVEL = self.workbox.LOG_LEVEL || {\n  none: -1,\n  verbose: 0,\n  debug: 1,\n  warn: 2,\n  error: 3,\n};\n\nconst LIGHT_GREY = `#bdc3c7`;\nconst DARK_GREY = `#7f8c8d`;\nconst LIGHT_GREEN = `#2ecc71`;\nconst LIGHT_YELLOW = `#f1c40f`;\nconst LIGHT_RED = `#e74c3c`;\nconst LIGHT_BLUE = `#3498db`;\n\n/**\n * A class that will only log given the current log level\n * defined by the developer.\n *\n * Define custom log level by setting `self.workbox.logLevel`.\n *\n * @example\n *\n * self.workbox.logLevel = self.workbox.LOG_LEVEL.verbose;\n *\n * @private\n */\nclass LogHelper {\n  /**\n   * LogHelper constructor.\n   */\n  constructor() {\n    this._defaultLogLevel = isDevBuild() ?\n      self.workbox.LOG_LEVEL.debug :\n      self.workbox.LOG_LEVEL.warn;\n  }\n\n  /**\n   * The most verbose log level.\n   *\n   * @param {Object} options The options of the log.\n   */\n  log(options) {\n    this._printMessage(self.workbox.LOG_LEVEL.verbose, options);\n  }\n\n  /**\n   * Useful for logs that are more exceptional that log()\n   * but not severe.\n   *\n   * @param {Object} options The options of the log.\n   */\n  debug(options) {\n    this._printMessage(self.workbox.LOG_LEVEL.debug, options);\n  }\n\n  /**\n   * Warning messages.\n   *\n   * @param {Object} options The options of the log.\n   */\n  warn(options) {\n    this._printMessage(self.workbox.LOG_LEVEL.warn, options);\n  }\n\n  /**\n   * Error logs.\n   *\n   * @param {Object} options The options of the log.\n   */\n  error(options) {\n    this._printMessage(self.workbox.LOG_LEVEL.error, options);\n  }\n\n  /**\n   * Method to print to the console.\n   * @param {number} logLevel\n   * @param {Object} logOptions\n   */\n  _printMessage(logLevel, logOptions) {\n    if (!this._shouldLogMessage(logLevel, logOptions)) {\n      return;\n    }\n\n    const logGroups = this._getAllLogGroups(logLevel, logOptions);\n    logGroups.print();\n  }\n\n  /**\n   * Print a user friendly log to the console.\n   * @param  {numer} logLevel A number from self.workbox.LOG_LEVEL\n   * @param  {Object} logOptions Arguments to print to the console\n   * @return {LogGroup} Returns a log group to print to the console.\n   */\n  _getAllLogGroups(logLevel, logOptions) {\n    const topLogGroup = new LogGroup();\n\n    const primaryMessage = this._getPrimaryMessageDetails(logLevel, logOptions);\n    topLogGroup.addPrimaryLog(primaryMessage);\n\n    if (logOptions.error) {\n      const errorMessage = {\n        message: logOptions.error,\n        logFunc: console.error,\n      };\n      topLogGroup.addLog(errorMessage);\n    }\n\n    const extraInfoGroup = new LogGroup();\n    if (logOptions.that && logOptions.that.constructor &&\n      logOptions.that.constructor.name) {\n      const className = logOptions.that.constructor.name;\n      extraInfoGroup.addLog(\n        this._getKeyValueDetails('class', className)\n      );\n    }\n\n    if (logOptions.data) {\n      if (typeof logOptions.data === 'object' &&\n        !(logOptions.data instanceof Array)) {\n        Object.keys(logOptions.data).forEach((keyName) => {\n          extraInfoGroup.addLog(\n            this._getKeyValueDetails(keyName, logOptions.data[keyName])\n          );\n        });\n      } else {\n        extraInfoGroup.addLog(\n          this._getKeyValueDetails('additionalData', logOptions.data)\n        );\n      }\n    }\n\n    topLogGroup.addChildGroup(extraInfoGroup);\n\n    return topLogGroup;\n  }\n\n  /**\n   * This is a helper function to wrap key value pairss to a colored key\n   * value string.\n   * @param  {string} key\n   * @param  {string} value\n   * @return {Object} The object containing a message, color and Arguments\n   * for the console.\n   */\n  _getKeyValueDetails(key, value) {\n    return {\n      message: `%c${key}: `,\n      colors: [`color: ${LIGHT_BLUE}`],\n      args: value,\n    };\n  }\n\n  /**\n   * Helper method to color the primary message for the log\n   * @param  {number} logLevel   One of self.workbox.LOG_LEVEL\n   * @param  {Object} logOptions Arguments to print to the console\n   * @return {Object} Object containing the message and color info to print.\n   */\n  _getPrimaryMessageDetails(logLevel, logOptions) {\n    let logLevelName;\n    let logLevelColor;\n    switch (logLevel) {\n      case self.workbox.LOG_LEVEL.verbose:\n        logLevelName = 'Info';\n        logLevelColor = LIGHT_GREY;\n        break;\n      case self.workbox.LOG_LEVEL.debug:\n        logLevelName = 'Debug';\n        logLevelColor = LIGHT_GREEN;\n        break;\n      case self.workbox.LOG_LEVEL.warn:\n        logLevelName = 'Warn';\n        logLevelColor = LIGHT_YELLOW;\n        break;\n      case self.workbox.LOG_LEVEL.error:\n        logLevelName = 'Error';\n        logLevelColor = LIGHT_RED;\n        break;\n    }\n\n    let primaryLogMessage = `%c🔧 %c[${logLevelName}]`;\n    const primaryLogColors = [\n      `color: ${LIGHT_GREY}`,\n      `color: ${logLevelColor}`,\n    ];\n\n    let message;\n    if (typeof logOptions === 'string') {\n      message = logOptions;\n    } else if (logOptions.message) {\n      message = logOptions.message;\n    }\n\n    if (message) {\n      message = message.replace(/\\s+/g, ' ');\n      primaryLogMessage += `%c ${message}`;\n      primaryLogColors.push(`color: ${DARK_GREY}; font-weight: normal`);\n    }\n\n    return {\n      message: primaryLogMessage,\n      colors: primaryLogColors,\n    };\n  }\n\n  /**\n   * Test if the message should actually be logged.\n   * @param {number} logLevel The level of the current log to be printed.\n   * @param {Object|String} logOptions The options to log.\n   * @return {boolean} Returns true of the message should be printed.\n   */\n  _shouldLogMessage(logLevel, logOptions) {\n    if (!logOptions) {\n      return false;\n    }\n\n    let minValidLogLevel = this._defaultLogLevel;\n    if (self && self.workbox && typeof self.workbox.logLevel === 'number') {\n      minValidLogLevel = self.workbox.logLevel;\n    }\n\n    if (minValidLogLevel === self.workbox.LOG_LEVEL.none ||\n      logLevel < minValidLogLevel) {\n      return false;\n    }\n\n    return true;\n  }\n}\n\nexport default new LogHelper();\n","/*\n Copyright 2017 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\nimport logHelper from './log-helper';\n\n/**\n * Warns users that an old property is deprecated in favor of a new property\n * and aliases the old name to the new name.\n * @param {Object} obj The object containing the methods.\n * @param {string} oldName The method to deprecate.\n * @param {string} newName The new method replacing the deprecated method.\n * @param {string} ctx The context project/object to identify the method names.\n */\nexport default (obj, oldName, newName, ctx) => {\n  if (Object.prototype.hasOwnProperty.call(obj, oldName)) {\n    logHelper.warn(\n        `${oldName} is deprecated; use ${newName} instead`, {Context: ctx});\n\n    obj[newName] = obj[oldName];\n  }\n};\n","'use strict';\n\n(function() {\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  var exp = {\n    open: function(name, version, upgradeCallback) {\n      var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n      var request = p.request;\n\n      request.onupgradeneeded = function(event) {\n        if (upgradeCallback) {\n          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n        }\n      };\n\n      return p.then(function(db) {\n        return new DB(db);\n      });\n    },\n    delete: function(name) {\n      return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n    }\n  };\n\n  if (typeof module !== 'undefined') {\n    module.exports = exp;\n    module.exports.default = module.exports;\n  }\n  else {\n    self.idb = exp;\n  }\n}());\n","/*\n Copyright 2016 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\n/* eslint-disable require-jsdoc */\n\nimport idb from 'idb';\n\n/**\n * A wrapper to store for an IDB connection to a particular ObjectStore.\n *\n * @private\n */\nclass IDBHelper {\n  constructor(name, version, storeName) {\n    if (name == undefined || version == undefined || storeName == undefined) {\n      throw Error('name, version, storeName must be passed to the ' +\n        'constructor.');\n    }\n\n    this._name = name;\n    this._version = version;\n    this._storeName = storeName;\n  }\n\n  /**\n   * Returns a promise that resolves with an open connection to IndexedDB,\n   * either existing or newly opened.\n   *\n   * @private\n   * @return {Promise<DB>}\n   */\n  _getDb() {\n    if (this._dbPromise) {\n      return this._dbPromise;\n    }\n\n    this._dbPromise = idb.open(this._name, this._version, (upgradeDB) => {\n      upgradeDB.createObjectStore(this._storeName);\n    })\n    .then((db) => {\n      return db;\n    });\n\n    return this._dbPromise;\n  }\n\n  close() {\n    if (!this._dbPromise) {\n      return;\n    }\n\n    return this._dbPromise\n    .then((db) => {\n      db.close();\n      this._dbPromise = null;\n    });\n  }\n\n  /**\n   * Wrapper on top of the idb wrapper, which simplifies saving the key/value\n   * pair to the object store.\n   * Returns a Promise that fulfills when the transaction completes.\n   *\n   * @private\n   * @param {String} key\n   * @param {Object} value\n   * @return {Promise<T>}\n   */\n  put(key, value) {\n    return this._getDb().then((db) => {\n      const tx = db.transaction(this._storeName, 'readwrite');\n      const objectStore = tx.objectStore(this._storeName);\n      objectStore.put(value, key);\n      return tx.complete;\n    });\n  }\n\n  /**\n   * Wrapper on top of the idb wrapper, which simplifies deleting an entry\n   * from the object store.\n   * Returns a Promise that fulfills when the transaction completes.\n   *\n   * @private\n   * @param {String} key\n   * @return {Promise<T>}\n   */\n  delete(key) {\n    return this._getDb().then((db) => {\n      const tx = db.transaction(this._storeName, 'readwrite');\n      const objectStore = tx.objectStore(this._storeName);\n      objectStore.delete(key);\n      return tx.complete;\n    });\n  }\n\n  /**\n   * Wrapper on top of the idb wrapper, which simplifies getting a key's value\n   * from the object store.\n   * Returns a promise that fulfills with the value.\n   *\n   * @private\n   * @param {String} key\n   * @return {Promise<Object>}\n   */\n  get(key) {\n    return this._getDb().then((db) => {\n      return db.transaction(this._storeName)\n        .objectStore(this._storeName)\n        .get(key);\n    });\n  }\n\n  /**\n   * Wrapper on top of the idb wrapper, which simplifies getting all the values\n   * in an object store.\n   * Returns a promise that fulfills with all the values.\n   *\n   * @private\n   * @return {Promise<Array<Object>>}\n   */\n  getAllValues() {\n    return this._getDb().then((db) => {\n      return db.transaction(this._storeName)\n        .objectStore(this._storeName)\n        .getAll();\n    });\n  }\n\n  /**\n   * Wrapper on top of the idb wrapper, which simplifies getting all the keys\n   * in an object store.\n   * Returns a promise that fulfills with all the keys.\n   *\n   * @private\n   * @param {String} storeName\n   * @return {Promise<Array<Object>>}\n   */\n  getAllKeys() {\n    return this._getDb().then((db) => {\n      return db.transaction(this._storeName)\n        .objectStore(this._storeName)\n        .getAllKeys();\n    });\n  }\n}\n\nexport default IDBHelper;\n","import IDBHelper from '../../../../lib/idb-helper';\n\n/**\n * Puts the fetched response in the IDB\n *\n * @param {Object} config\n * @private\n */\nasync function putResponse({hash, idbObject, response, idbQDb}) {\n  const _idbQHelper = idbQDb;\n  idbObject.response = {\n    headers: JSON.stringify([...response.headers]),\n    status: response.status,\n    body: await response.blob(),\n  };\n  _idbQHelper.put(hash, idbObject);\n}\n\n/**\n * This function returns the fetched response for the given id of the request\n *\n * @memberof module:workbox-background-sync\n * @private\n * @param {String} id The ID of the request given back by the broaadcast\n * channel\n * @return {Object} response Fetched response of the request.\n */\nasync function getResponse({id, dbName}) {\n  const _idbQHelper = new IDBHelper(dbName, 1, 'QueueStore');\n  const object = await _idbQHelper.get(id);\n  if (object && object.response) {\n    return object.response;\n  } else {\n    return null;\n  }\n}\n\nexport {\n  putResponse,\n  getResponse,\n};\n","const maxAge = 5*24*60*60*1000; // 5days\nconst defaultDBName = 'bgQueueSyncDB';\nconst broadcastMessageAddedType = 'BACKGROUND_REQUESTED_ADDED';\nconst broadcastMessageFailedType = 'BACKGROUND_REQUESTED_FAILED';\nconst defaultQueueName = 'DEFAULT_QUEUE';\nconst tagNamePrefix = 'SW_BACKGROUND_QUEUE_TAG_';\nconst broadcastMeta = 'SW_BACKGROUND_SYNC_QUEUE';\nconst allQueuesPlaceholder = 'QUEUES';\nconst replayAllQueuesTag = 'SW_BACKGROUND_QUEUE_TAG_REPLAY';\nexport {\n  maxAge,\n  defaultDBName,\n  broadcastMessageAddedType,\n  broadcastMessageFailedType,\n  defaultQueueName,\n  tagNamePrefix,\n  broadcastMeta,\n  allQueuesPlaceholder,\n  replayAllQueuesTag,\n};\n","import IDBHelper from '../../../../lib/idb-helper';\nimport {allQueuesPlaceholder} from './constants';\n/**\n * takes a request and gives back JSON object that is storable in IDB\n *\n * @param {Request} request request object to transform\n * into iDB storable object\n * @param {Object} config config object to be\n * stored along in the iDB\n * @return {Object} indexable object for iDB\n *\n * @memberOf RequestManager\n * @private\n */\nasync function getQueueableRequest({request, config}) {\n  let requestObject={\n    config,\n    metadata: {\n      creationTimestamp: Date.now(),\n    },\n  };\n  requestObject.request = {\n    url: request.url,\n    headers: JSON.stringify([...request.headers]),\n    mode: request.mode,\n    method: request.method,\n    redirect: request.redirect,\n    credentials: request.credentials,\n  };\n  const requestBody = await request.text();\n  if (requestBody.length > 0) {\n    requestObject.request.body = requestBody;\n  }\n  return requestObject;\n}\n\n/**\n * takes an object and return a Request object to be executed by\n * the browser\n * @param {Object} idbRequestObject\n * @return {Request}\n * @private\n */\nasync function getFetchableRequest({idbRequestObject}) {\n  let reqObject = {\n    mode: idbRequestObject.mode,\n    method: idbRequestObject.method,\n    redirect: idbRequestObject.redirect,\n    headers: new Headers(JSON.parse(idbRequestObject.headers)),\n    credentials: idbRequestObject.credentials,\n  };\n  if (idbRequestObject.body) {\n    reqObject.body = idbRequestObject.body;\n  }\n  return new Request(idbRequestObject.url, reqObject);\n}\n\n/**\n * clean up the queue, deleting all the tasks who are either damaged or\n * whose maxAge has expired\n *\n * @memberOf Queue\n * @private\n * @param {string} dbName Name of database to cleanup.\n * @return {Promise}\n */\nasync function cleanupQueue(dbName) {\n  let db = new IDBHelper(dbName, 1, 'QueueStore');\n  let queueObj = await db.get(allQueuesPlaceholder);\n\n  if (!queueObj) {\n    return null;\n  }\n\n  await Promise.all(queueObj.map(async (queueName) => {\n    const requestQueues = await db.get(queueName);\n    let itemsToKeep = [];\n    let deletionPromises = [];\n    await Promise.all(requestQueues.map(async (hash) => {\n      const requestData = await db.get(hash);\n      if (requestData && requestData.metadata\n        && requestData.metadata.creationTimestamp + requestData.config.maxAge\n          <= Date.now()) {\n        // Delete items that are too old.\n        deletionPromises.push(db.delete(hash));\n      } else {\n        // Keep elements whose definition exists in idb.\n        itemsToKeep.push(hash);\n      }\n    }));\n    await Promise.all(deletionPromises);\n    db.put(queueName, itemsToKeep);\n  }));\n}\n\nexport {\n  getQueueableRequest,\n  getFetchableRequest,\n  cleanupQueue,\n};\n","import deprecate from '../../../../lib/deprecate';\nimport {putResponse} from './response-manager';\nimport {getFetchableRequest} from './queue-utils';\nimport {tagNamePrefix, replayAllQueuesTag} from './constants';\n\n/**\n * Class to handle all the request related\n * transformations, replaying, event handling\n * broadcasting back to controlled pages etc.\n * @class\n * @private\n */\nclass RequestManager {\n  /**\n   * Initializes the request manager\n   * stores the callbacks object, maintains config and\n   * attaches event handler\n   * @param {Object=} config\n   *\n   * @private\n   */\n  constructor({callbacks, queue} = {}) {\n    callbacks = callbacks || {};\n\n    // Rename deprecated callbacks.\n    const ctx = 'workbox-background-sync.RequestManager.callbacks';\n    deprecate(callbacks, 'onResponse', 'replayDidSucceed', ctx);\n    deprecate(callbacks, 'onRetryFailure', 'replayDidFail', ctx);\n\n    this._globalCallbacks = callbacks;\n    this._queue = queue;\n    this.attachSyncHandler();\n  }\n\n  /**\n   * attaches sync handler to replay requests when\n   * sync event is fired\n   *\n   * @private\n   */\n  attachSyncHandler() {\n    self.addEventListener('sync', (event) => {\n      if (event.tag === tagNamePrefix + this._queue.queueName\n        || event.tag === replayAllQueuesTag) {\n        event.waitUntil(this.replayRequests());\n      }\n    });\n  }\n\n  /**\n   * function to play one single request given its hash\n   *\n   * @param {String} hash\n   *\n   * @return {Promise} Resolves if the request corresponding to the hash is\n   * played successfully, rejects if it fails during the replay\n   *\n   *\n   * @private\n   */\n  async replayRequest(hash) {\n    try {\n      const reqData = await this._queue.getRequestFromQueue({hash});\n      if (reqData.response) {\n        return;\n      }\n      const request = await getFetchableRequest({\n        idbRequestObject: reqData.request,\n      });\n      const response = await fetch(request);\n      if (!response.ok) {\n        return Promise.reject(response);\n      } else {\n        // not blocking on putResponse.\n        putResponse({\n          hash,\n          idbObject: reqData,\n          response: response.clone(),\n          idbQDb: this._queue.idbQDb,\n        });\n        if (this._globalCallbacks.replayDidSucceed) {\n          this._globalCallbacks.replayDidSucceed(hash, response);\n        }\n      }\n    } catch (err) {\n      return Promise.reject(err);\n    }\n  }\n\n  /**\n   * This function is to be called to replay all the requests\n   * in the current queue. It will play all the requests and return a promise\n   * based on the successfull execution of the requests.\n   *\n   * @return {Promise} Resolves if all requests are played successfully,\n   * rejects if any of the request fails during the replay\n   *\n   * @private\n   */\n  async replayRequests() {\n    const failedItems = [];\n    for (let hash of await this._queue.getQueue()) {\n      try {\n        await this.replayRequest(hash);\n      } catch (err) {\n        if (this._globalCallbacks.replayDidFail) {\n          this._globalCallbacks.replayDidFail(hash, err);\n        }\n        failedItems.push(err);\n      }\n    }\n    return failedItems.length > 0 ?\n      Promise.reject(failedItems) : Promise.resolve();\n  }\n}\n\nexport default RequestManager;\n","/*\n Copyright 2016 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\n/**\n * A no-op export matching the ErrorStackParser interface, to be included in\n * production, minified builds.\n */\nexport default {\n  parse: () => [],\n};\n","/*\n Copyright 2016 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\n/* eslint-disable require-jsdoc */\n\nimport ErrorStackParser from 'error-stack-parser';\n\nexport function atLeastOne(object) {\n  const parameters = Object.keys(object);\n  if (!parameters.some((parameter) => object[parameter] !== undefined)) {\n    throwError('Please set at least one of the following parameters: ' +\n      parameters.map((p) => `'${p}'`).join(', '));\n  }\n}\n\nexport function hasMethod(object, expectedMethod) {\n  const parameter = Object.keys(object).pop();\n  const type = typeof object[parameter][expectedMethod];\n  if (type !== 'function') {\n    throwError(`The '${parameter}' parameter must be an object that exposes a\n      '${expectedMethod}' method.`);\n  }\n}\n\nexport function isInstance(object, expectedClass) {\n  const parameter = Object.keys(object).pop();\n  if (!(object[parameter] instanceof expectedClass)) {\n    throwError(`The '${parameter}' parameter must be an instance of\n      '${expectedClass.name}'`);\n  }\n}\n\nexport function isOneOf(object, values) {\n  const parameter = Object.keys(object).pop();\n  if (!values.includes(object[parameter])) {\n    throwError(`The '${parameter}' parameter must be set to one of the\n      following: ${values}`);\n  }\n}\n\nexport function isType(object, expectedType) {\n  const parameter = Object.keys(object).pop();\n  const actualType = typeof object[parameter];\n  if (actualType !== expectedType) {\n    throwError(`The '${parameter}' parameter has the wrong type. (Expected:\n      ${expectedType}, actual: ${actualType})`);\n  }\n}\n\nexport function isArrayOfType(object, expectedType) {\n  const parameter = Object.keys(object).pop();\n  const message = `The '${parameter}' parameter should be an array containing\n    one or more '${expectedType}' elements.`;\n\n  if (!Array.isArray(object[parameter])) {\n    throwError(message);\n  }\n\n  for (let item of object[parameter]) {\n    if (typeof item !== expectedType) {\n      throwError(message);\n    }\n  }\n}\n\nexport function isArrayOfClass(object, expectedClass) {\n  const parameter = Object.keys(object).pop();\n  const message = `The '${parameter}' parameter should be an array containing\n    one or more '${expectedClass.name}' instances.`;\n\n  if (!Array.isArray(object[parameter])) {\n    throwError(message);\n  }\n\n  for (let item of object[parameter]) {\n    if (!(item instanceof expectedClass)) {\n      throwError(message);\n    }\n  }\n}\n\nexport function isValue(object, expectedValue) {\n  const parameter = Object.keys(object).pop();\n  const actualValue = object[parameter];\n  if (actualValue !== expectedValue) {\n    throwError(`The '${parameter}' parameter has the wrong value. (Expected:\n      ${expectedValue}, actual: ${actualValue})`);\n  }\n}\n\nfunction throwError(message) {\n  // Collapse any newlines or whitespace into a single space.\n  message = message.replace(/\\s+/g, ' ');\n\n  const error = new Error(message);\n  error.name = 'assertion-failed';\n\n  const stackFrames = ErrorStackParser.parse(error);\n\n  // If, for some reason, we don't have all the stack information we need,\n  // we'll just end up throwing a basic Error.\n  if (stackFrames.length >= 3) {\n    // Assuming we have the stack frames, set the message to include info\n    // about what the underlying method was, and set the name to reflect\n    // the assertion type that failed.\n    error.message = `Invalid call to ${stackFrames[2].functionName}() — ` +\n      message;\n  }\n\n  throw error;\n}\n","import {broadcastMeta} from './constants';\nimport {isType, isInstance} from '../../../../lib/assert';\n\n/**\n * broadcasts the message with the given type and url\n *\n * @param {BroadcastChannel} broadcastChannel which is used to push the\n * updates on\n * @param {Object} input\n * @param {string} input.type Type of the message (either success or failure)\n * @param {string} input.url Url for which the request was queued\n * @private\n */\nfunction broadcastMessage({broadcastChannel, type, url}) {\n  if (!broadcastChannel) {\n    return;\n  }\n\n  isInstance({broadcastChannel}, BroadcastChannel);\n  isType({type}, 'string');\n  isType({url}, 'string');\n\n  broadcastChannel.postMessage({\n    type: type,\n    meta: broadcastMeta,\n    payload: {\n      url: url,\n    },\n  });\n}\n\nexport {\n  broadcastMessage,\n};\n","import {getQueueableRequest} from './queue-utils';\nimport {broadcastMessage} from './broadcast-manager';\nimport {\n  broadcastMessageAddedType,\n  broadcastMessageFailedType,\n  defaultQueueName,\n  tagNamePrefix,\n  allQueuesPlaceholder,\n} from './constants';\nimport {isInstance, isType} from '../../../../lib/assert';\n\nlet _requestCounter = 0;\nlet _queueCounter = 0;\n\n/**\n * Queue class to maintain and perform on the logical requests queue\n *\n * @class RequestQueue\n * @private\n */\nclass RequestQueue {\n  /**\n   * Creates an instance of RequestQueue.\n   *\n   * @param {Object} config\n   *\n   * @memberOf RequestQueue\n   * @private\n   */\n  constructor({\n    config,\n    queueName = defaultQueueName + '_' + _queueCounter++,\n    idbQDb,\n    broadcastChannel,\n    callbacks,\n  }) {\n    this._isQueueNameAddedToAllQueue = false;\n    this._queueName = queueName;\n    this._config = config;\n    this._idbQDb = idbQDb;\n    this._broadcastChannel = broadcastChannel;\n    this._globalCallbacks = callbacks || {};\n    this._queue = [];\n    this._initializationPromise = this.initQueue();\n  }\n\n  /**\n   * initializes the queue from the IDB store\n   *\n   * @memberOf RequestQueue\n   * @private\n   */\n  async initQueue() {\n    const idbQueue = await this._idbQDb.get(this._queueName);\n    if (idbQueue) {\n      this._queue.push(...idbQueue);\n    }\n  }\n\n  /**\n   * adds the current queueName to all queue array\n   *\n   * @memberOf RequestQueue\n   * @private\n   */\n  async addQueueNameToAllQueues() {\n    if (!this._isQueueNameAddedToAllQueue) {\n      let allQueues = await this._idbQDb.get(allQueuesPlaceholder);\n      allQueues = allQueues || [];\n      if (!allQueues.includes(this._queueName)) {\n        allQueues.push(this._queueName);\n      }\n      this._idbQDb.put(allQueuesPlaceholder, allQueues);\n      this._isQueueNameAddedToAllQueue = true;\n    }\n  }\n\n  /**\n   * saves the logical queue to IDB\n   *\n   * @memberOf RequestQueue\n   * @private\n   */\n  async saveQueue() {\n    await this._idbQDb.put(this._queueName, await this.getQueue());\n  }\n\n  /**\n   * push any request to background sync queue which would be played later\n   * preferably when network comes back\n   *\n   * @param {Request} request request object to be queued by this\n   * @return {Promise}\n   *\n   * @memberOf Queue\n   * @private\n   */\n  async pushIntoQueue({request}) {\n    // Any request should be pushed only after it is initialized\n    await this.getQueue();\n    isInstance({request}, Request);\n\n    const hash = `${request.url}!${Date.now()}!${_requestCounter++}`;\n    const reqData = await getQueueableRequest({\n      request,\n      config: this._config,\n    });\n\n    // Apply the `requestWillEnqueue` callback so plugins can modify the\n    // request data before it's stored in IndexedDB.\n    if (this._globalCallbacks.requestWillEnqueue) {\n      this._globalCallbacks.requestWillEnqueue(reqData);\n    }\n\n    try {\n      this._queue.push(hash);\n\n      // add to queue\n      await Promise.all([\n         this.saveQueue(),\n         this._idbQDb.put(hash, reqData),\n         this.addQueueNameToAllQueues(),\n      ]);\n      // register sync\n      self.registration &&\n        self.registration.sync.register(tagNamePrefix + this._queueName);\n\n      // broadcast the success of request added to the queue\n      broadcastMessage({\n        broadcastChannel: this._broadcastChannel,\n        type: broadcastMessageAddedType,\n        id: hash,\n        url: request.url,\n      });\n\n      return hash;\n    } catch (err) {\n      // broadcast the failure of request added to the queue\n      broadcastMessage({\n        broadcastChannel: this._broadcastChannel,\n        type: broadcastMessageFailedType,\n        id: hash,\n        url: request.url,\n      });\n\n      return err;\n    }\n  }\n\n  /**\n   * get the Request from the queue at a particular index\n   *\n   * @param {string} hash hash of the request at the given index\n   * @return {Promise<Object>} request object corresponding to given hash\n   * @memberOf Queue\n   * @private\n   */\n  async getRequestFromQueue({hash}) {\n    const queue = await this.getQueue();\n    isType({hash}, 'string');\n\n    if (queue.includes(hash)) {\n      const reqData = await this._idbQDb.get(hash);\n\n      // Apply the `requestWillDequeue` callback so plugins can modify the\n      // stored data before it's converted back into a request to be replayed.\n      if (this._globalCallbacks.requestWillDequeue) {\n        this._globalCallbacks.requestWillDequeue(reqData);\n      }\n\n      return reqData;\n    }\n  }\n\n  /**\n   * returns the name of the current queue\n   *\n   * @readonly\n   *\n   * @memberOf RequestQueue\n   * @private\n   */\n  get queueName() {\n    return this._queueName;\n  }\n\n  /**\n   * returns the queue after initialization is complete\n   *\n   * @return {Promise<Object>} Queue object containing the current requests\n   * @readonly\n   * @memberOf RequestQueue\n   * @private\n   */\n  async getQueue() {\n    await this._initializationPromise;\n    return Object.assign([], this._queue);\n  }\n\n  /**\n   * returns the instance of IDBStore\n   *\n   * @readonly\n   *\n   * @memberOf RequestQueue\n   * @private\n   */\n  get idbQDb() {\n    return this._idbQDb;\n  }\n}\n\nexport default RequestQueue;\n","import RequestManager from './request-manager';\nimport RequestQueue from './request-queue';\nimport {maxAge, defaultDBName} from './constants';\nimport {isType, isInstance} from '../../../../lib/assert';\nimport IDBHelper from '../../../../lib/idb-helper';\nimport {cleanupQueue} from './queue-utils';\nimport {getResponse} from './response-manager';\n\n/**\n * Use the instance of this class to push the failed requests into the queue.\n *\n * @example\n * When you want to push the requests manually\n * let bgQueue = new workbox.backgroundSync.Queue();\n * self.addEventListener('fetch', function(e) {\n *   if (!e.request.url.startsWith('https://jsonplaceholder.typicode.com')) {\n *     return;\n *   }\n *\n *   const clone = e.request.clone();\n *   e.respondWith(fetch(e.request).catch((err) => {\n *     bgQueue.pushIntoQueue({\n *       request: clone,\n *     });\n *     throw err;\n *   }));\n * });\n *\n * @memberof module:workbox-background-sync\n */\nclass Queue {\n  /**\n   * Creates an instance of Queue with the given options\n   *\n   * @param {Object} [input]\n   * @param {Number} [input.maxRetentionTime = 5 days] Time for which a queued\n   * request will live in the queue(irrespective of failed/success of replay).\n   * @param {Object} [input.callbacks] Callbacks for successfull/failed\n   * replay of a request as well as modifying before enqueue/dequeue-ing.\n   * @param {Fuction} [input.callbacks.replayDidSucceed]\n   * Invoked with params (hash:string, response:Response) after a request is\n   * successfully replayed.\n   * @param {Fuction<string>} [input.callbacks.replayDidFail]\n   * Invoked with param (hash:string) after a replay attempt has failed.\n   * @param {Fuction<Object>} [input.callbacks.requestWillEnqueue]\n   * Invoked with param (reqData:Object) before a failed request is saved to\n   * the queue. Use this to modify the saved data.\n   * @param {Fuction<Object>} [input.callbacks.requestWillDequeue]\n   * Invoked with param (reqData:Object) before a failed request is retrieved\n   * from the queue. Use this to modify the data before the request is replayed.\n   * @param {string} [input.queueName] Queue name inside db in which\n   * requests will be queued.\n   * @param {BroadcastChannel=} [input.broadcastChannel] BroadcastChannel\n   * which will be used to publish messages when the request will be queued.\n   */\n  constructor({\n    broadcastChannel,\n    callbacks,\n    queueName,\n    dbName = defaultDBName,\n    maxRetentionTime = maxAge,\n  } = {}) {\n  if (queueName) {\n    isType({queueName}, 'string');\n  }\n\n    if (maxRetentionTime) {\n      isType({maxRetentionTime}, 'number');\n    }\n\n    if (broadcastChannel) {\n      isInstance({broadcastChannel}, BroadcastChannel);\n    }\n\n    isType({dbName}, 'string');\n\n    this._dbName = dbName;\n    this._queue = new RequestQueue({\n      config: {\n        maxAge: maxRetentionTime,\n      },\n      queueName,\n      idbQDb: new IDBHelper(this._dbName, 1, 'QueueStore'),\n      broadcastChannel,\n      callbacks,\n    });\n    this._requestManager = new RequestManager({\n      callbacks,\n      queue: this._queue,\n    });\n\n    this.cleanupQueue();\n  }\n\n  /**\n   * clean up the queue, deleting all the tasks whose maxAge has expired\n   *\n   * @memberOf Queue\n   * @private\n   * @return {Promise}\n   */\n  cleanupQueue() {\n    return cleanupQueue(this._dbName);\n  }\n\n  /**\n   * This function pushes a given request into the IndexedDb Queue.\n   *\n   * @param {Object} input\n   * @param {Request} input.request The request which is to be queued\n   *\n   * @return {Promise} Promise which resolves when the request is pushed in\n   * the queue.\n   */\n  pushIntoQueue({request}) {\n    isInstance({request}, Request);\n    return this._queue.pushIntoQueue({request});\n  }\n\n  /**\n   * Replays all the requests in the queue, this can be used for custom timing\n   * of replaying requests may be in an environment where sync event is not\n   * supported.\n   * @return {Promise} A listener for when the requests have been replayed.\n   */\n  replayRequests() {\n    return this._requestManager.replayRequests();\n  }\n\n  /**\n   * Sets the dbName, which is used to store the queue and requests\n   * defaults to bgQueueSyncDB.\n   * @param {String} id The ID of the request.\n   * @return {Object} Fetched response of the request.\n   */\n  getResponse({id}) {\n    return getResponse({\n      id,\n      dbName: this._dbName,\n    });\n  }\n}\n\nexport default Queue;\n","import Queue from './background-sync-queue';\n\n/**\n * Use the instance of this class to push the failed requests into the queue.\n *\n * @example <caption>When you want the workbox-sw framework to take care of\n * failed requests.</caption>\n * let bgQueue = new workbox.backgroundSync.QueuePlugin({\n *   callbacks: {\n *     replayDidSucceed: async(hash, res) => {\n *       self.registration.showNotification('Background sync demo', {\n *         body: 'Product has been purchased.',\n *         icon: '/images/shop-icon-384.png',\n *        });\n *     },\n *     replayDidFail: (hash) => {},\n *     requestWillEnqueue: (reqData) => {},\n *     requestWillDequeue: (reqData) => {},\n *   },\n * });\n *\n * const requestWrapper = new workbox.runtimeCaching.RequestWrapper({\n *   plugins: [bgQueue],\n * });\n *\n * const route = new workbox.routing.RegExpRoute({\n *   regExp: new RegExp('^https://jsonplaceholder.typicode.com'),\n *   handler: new workbox.runtimeCaching.NetworkOnly({requestWrapper}),\n * });\n *\n * const router = new workbox.routing.Router();\n * router.registerRoute({route});\n *\n * @memberof module:workbox-background-sync\n * @extends module:workbox-background-sync.Queue\n */\nclass QueuePlugin extends Queue {\n  /**\n   * Wraps `pushIntoQueue` in a callback used by higher level framework.\n   * This function pushes a given request into the IndexedDb Queue.\n   * NOTE: If you are writting the fetch handler for background sync manually,\n   * please ignore this.\n   *\n   * @param {Object} input\n   * @param {Request} input.request The request which is to be queued\n   *\n   * @return {Promise} Promise which resolves when the request is pushed in\n   * the queue.\n   */\n  fetchDidFail({request}) {\n    return this.pushIntoQueue({request});\n  }\n}\n\nexport default QueuePlugin;\n"],"names":["constructor","_logs","_childGroups","_isFallbackMode","exec","navigator","userAgent","parseInt","addPrimaryLog","_primaryLog","addLog","push","addChildGroup","length","print","_printLogDetails","console","groupCollapsed","_getLogContent","forEach","groupEnd","logFunc","log","message","replace","colors","concat","args","self","workbox","LOG_LEVEL","none","verbose","debug","warn","error","DARK_GREY","LIGHT_GREEN","LIGHT_YELLOW","LIGHT_RED","LIGHT_BLUE","_defaultLogLevel","isDevBuild","_printMessage","_shouldLogMessage","_getAllLogGroups","_getPrimaryMessageDetails","that","name","_getKeyValueDetails","data","Object","keys","LIGHT_GREY","logLevel","prototype","hasOwnProperty","call","logHelper","Context","slice","onsuccess","result","onerror","apply","then","request","defineProperty","get","set","arguments","_index","_cursor","_request","_store","_tx","complete","oncomplete","onabort","_db","oldVersion","transaction","IDBIndex","IDBCursor","resolve","createIndex","index","IDBObjectStore","objectStore","IDBTransaction","createObjectStore","IDBDatabase","getAll","iterateCursor","value","continue","open","indexedDB","onupgradeneeded","delete","exports","_name","_version","_storeName","_getDb","_dbPromise","idb","close","put","getAllValues","getAllKeys","hash","idbObject","response","idbQDb","headers","JSON","stringify","status","body","blob","id","dbName","defaultDBName","broadcastMessageAddedType","broadcastMessageFailedType","defaultQueueName","tagNamePrefix","broadcastMeta","allQueuesPlaceholder","replayAllQueuesTag","config","metadata","creationTimestamp","Date","now","url","mode","method","redirect","credentials","text","idbRequestObject","parse","all","map","maxAge","callbacks","queue","deprecate","_globalCallbacks","_queue","attachSyncHandler","addEventListener","tag","queueName","waitUntil","replayRequests","replayRequest","getRequestFromQueue","ok","reject","putResponse","clone","replayDidSucceed","getQueue","replayDidFail","Promise","pop","throwError","ErrorStackParser","functionName","broadcastChannel","type","isInstance","BroadcastChannel","isType","postMessage","meta","payload","_queueCounter","_isQueueNameAddedToAllQueue","_queueName","_config","_idbQDb","_broadcastChannel","_initializationPromise","initQueue","addQueueNameToAllQueues","includes","saveQueue","pushIntoQueue","Request","_requestCounter","requestWillEnqueue","registration","sync","register","broadcastMessage","requestWillDequeue","assign","maxRetentionTime","_dbName","_requestManager","cleanupQueue","getResponse","fetchDidFail"],"mappings":"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"}